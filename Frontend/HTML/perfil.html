<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil de la Institución - Biblioteca</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>


  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Estilos personalizados -->
  <link rel="stylesheet" href="CSS/perfil.css">
  <link rel="stylesheet" href="CSS/variables.css">
</head>

<body class="d-flex">

  <!-- Sidebar mejorado con mejor espaciado y diseño proporcionado -->
  <div class="sidebar d-flex flex-column flex-shrink-0 bg-dark text-white" style="width: 260px; min-height: 100vh; position: fixed; top: 0; left: 0; z-index: 1000;">
    <div class="sidebar-header p-4 text-center border-bottom border-secondary">
      <h4 class="mb-0 fw-bold">Gestión administrativa</h4>
    </div>
    <ul class="nav nav-pills flex-column mb-auto px-3 py-4">
      <li class="nav-item mb-2">
        <a href="/dashboard" class="nav-link text-white d-flex align-items-center py-3 px-3">
          <i class="bi bi-house-door fs-5 me-3"></i>
          <span>Dashboard</span>
        </a>
      </li>
      <li class="nav-item mb-2">
        <a href="/libros" class="nav-link text-white d-flex align-items-center py-3 px-3">
          <i class="bi bi-book fs-5 me-3"></i>
          <span>Libros</span>
        </a>
      </li>
      <li class="nav-item mb-2">
        <a href="/miembros" class="nav-link text-white d-flex align-items-center py-3 px-3">
          <i class="bi bi-people fs-5 me-3"></i>
          <span>Miembros</span>
        </a>
      </li>
      <li class="nav-item mb-2">
        <a href="/prestamos" class="nav-link text-white d-flex align-items-center py-3 px-3">
          <i class="bi bi-journal-check fs-5 me-3"></i>
          <span>Préstamos</span>
        </a>
      </li>
      <li class="nav-item mb-2">
        <a href="/perfil" class="nav-link text-white active d-flex align-items-center py-3 px-3">
          <i class="bi bi-person-circle fs-5 me-3"></i>
          <span>Perfil</span>
        </a>
      </li>
    </ul>
    <div class="mt-auto p-3 border-top border-secondary">
      <button id="logoutButton" class="nav-link btn btn-link text-danger fw-bold w-100 text-start d-flex align-items-center py-3 px-3">
        <i class="bi bi-box-arrow-right fs-5 me-3"></i>
        <span>Salir</span>
      </button>
    </div>
  </div>

  <!-- Contenedor principal con scroll -->
  <div class="main-content flex-grow-1 d-flex flex-column" style="margin-left: 260px;">
    
    <!-- Navbar superior -->
    <nav class="navbar-top shadow-sm">
      <div class="container-fluid px-4 py-3">
        <div class="row w-100 align-items-center">
          <div class="col-12">
            <h2 class="perfil-title mb-0">
              <i class="bi bi-gear-fill me-2"></i>CONFIGURACIÓN DEL PERFIL
            </h2>
          </div>
        </div>
      </div>
    </nav>

    <!-- Contenido principal con scroll -->
    <div class="perfil-content p-4">

      <!-- Sección: Información de la Institución -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-header bg-primary-gradient text-white">
              <h5 class="mb-0">
                <i class="bi bi-building me-2"></i>Información de la Institución
              </h5>
            </div>
            <div class="card-body">
              <form id="formInstitucion">
                <div class="row">
                  
                  <!-- Logo/Foto de perfil -->
                  <div class="col-12 col-md-4 text-center mb-4">
                    <div class="logo-preview-container mb-3">
                      <img src="/placeholder.svg?height=200&width=200" 
                           alt="Logo de la institución" 
                           class="logo-preview" 
                           id="logoPreview">
                      <div class="logo-overlay">
                        <i class="bi bi-camera-fill"></i>
                      </div>
                    </div>
                    <input type="file" class="d-none" id="inputLogo" name="logo">

                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="document.getElementById('inputLogo').click()">
                      <i class="bi bi-upload me-2"></i>Cambiar Logo
                    </button>
                    <!-- <p class="text-muted mt-2 small">Tamaño recomendado: 200x200px<br>Formato: JPG, PNG</p> -->
                  </div>

                  <!-- Campos de información -->
                  <div class="col-12 col-md-8">
                    <div class="mb-3">
                      <label for="nombreInstitucion" class="form-label fw-bold">
                        <i class="bi bi-building me-2"></i>Nombre de la Institución
                      </label>
                      <input type="text" class="form-control" id="nombreInstitucion" 
                             value="" required>
                      <small class="text-muted">Este nombre aparecerá en toda la plataforma</small>
                    </div>

                    <div class="row">
                      <div class="col-md-6 mb-3">
                        <label for="tipoInstitucion" class="form-label fw-bold">
                          <i class="bi bi-tag me-2"></i>Tipo de Institución
                        </label>
                        <select class="form-select" id="tipoInstitucion" required>
                          <option value="universidad">Universidad</option>
                          <option value="colegio">Colegio</option>
                          <option value="biblioteca">Biblioteca Pública</option>
                          <option value="instituto">Instituto Técnico</option>
                        </select>
                      </div>

                      <div class="col-md-6 mb-3">
                        <label for="telefonoInstitucion" class="form-label fw-bold">
                          <i class="bi bi-telephone me-2"></i>Teléfono
                        </label>
                        <input type="tel" class="form-control" id="telefonoInstitucion" 
                               value="" required>
                      </div>
                    </div>

                    <div class="mb-3">
                      <label for="direccionInstitucion" class="form-label fw-bold">
                        <i class="bi bi-geo-alt me-2"></i>Dirección
                      </label>
                      <input type="text" class="form-control" id="direccionInstitucion" 
                             value="" required>
                      <input type="hidden" id="latInstitucion" name="lat">
                      <input type="hidden" id="lngInstitucion" name="lng">
                    </div>
                    <div class="mb-3">
                      <label class="form-label fw-bold">
                        <i class="bi bi-map me-2"></i>Mapa de la Ubicación
                      </label>
                      <div id="mapContainer" style="height: 350px;">
                        <!-- El mapa se insertará aquí dinámicamente -->
                      </div>
                    </div>


                    <button type="submit" class="btn btn-success">
                      <i class="bi bi-check-circle me-2"></i>Guardar Información
                    </button>
                  </div>

                </div>
              </form>
            </div>
          </div>
        </div>
      </div>




  <!-- Sección: Personalización de la Plataforma -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-header bg-info-gradient text-white">
              <h5 class="mb-0">
                <i class="bi bi-palette me-2"></i>Personalización de la Plataforma
              </h5>
            </div>
            <div class="card-body">
              <form id="formPersonalizacion">
                <div class="row">
                  
                  <div class="col-12 col-md-6 mb-3">
                    <label for="nombrePlataforma" class="form-label fw-bold">
                      <i class="bi bi-card-heading me-2"></i>Nombre de bienvenida de la Plataforma
                    </label>
                    <input type="text" class="form-control" id="nombrePlataforma" 
                           value="Sistema de Gestión Bibliotecaria" required>
                    <small class="text-muted">Título que aparece en la vista de inicio de sesion</small>
                  </div>

                  <div class="col-12 col-md-6 mb-3">
                    <label for="eslogan" class="form-label fw-bold">
                      <i class="bi bi-quote me-2"></i>Eslogan (Opcional)
                    </label>
                    <input type="text" class="form-control" id="eslogan" 
                           value="Fomentando el amor por la lectura" placeholder="Ingresa un eslogan...">
                  </div>

                  <div class="col-12 col-md-4 mb-3">
                    <label for="colorPrimario" class="form-label fw-bold">
                      <i class="bi bi-palette-fill me-2"></i>Color Primario
                    </label>
                    <div class="input-group">
                      <input type="color" class="form-control form-control-color" id="colorPrimario" value="#003049">
                      <input type="text" class="form-control" value="#003049" readonly>
                    </div>
                  </div>

                  <div class="col-12 col-md-4 mb-3">
                    <label for="colorSecundario" class="form-label fw-bold">
                      <i class="bi bi-palette-fill me-2"></i>Color Secundario
                    </label>
                    <div class="input-group">
                      <input type="color" class="form-control form-control-color" id="colorSecundario" value="#023e8a">
                      <input type="text" class="form-control" value="#023e8a" readonly>
                    </div>
                  </div>

                  <div class="col-12 col-md-4 mb-3">
                    <label for="colorAcento" class="form-label fw-bold">
                      <i class="bi bi-palette-fill me-2"></i>Color de Acento
                    </label>
                    <div class="input-group">
                      <input type="color" class="form-control form-control-color" id="colorAcento" value="#669bbc">
                      <input type="text" class="form-control" value="#669bbc" readonly>
                    </div>
                  </div>

                  <div class="col-12">
                    <button type="submit" class="btn btn-info text-white">
                      <i class="bi bi-brush me-2"></i>Guardar Personalización
                    </button>
                    <button type="button" class="btn btn-outline-secondary ms-2" onclick="resetearColores()">
                      <i class="bi bi-arrow-clockwise me-2"></i>Restablecer Colores
                    </button>
                  </div>

                </div>
              </form>
            </div>
          </div>
        </div>
      </div>




      <!-- Sección: Configuración de Cuenta -->
      <div class="row mb-4">
        <div class="col-12 col-lg-6 mb-4">
          <div class="card shadow-sm h-100">
            <div class="card-header bg-secondary-gradient text-white">
              <h5 class="mb-0">
                <i class="bi bi-person-circle me-2"></i>Usuario y Correo
              </h5>
            </div>
            <div class="card-body">
              <form id="formUsuario">
                <div class="mb-3">
                  <label for="nombreUsuario" class="form-label fw-bold">
                    <i class="bi bi-person me-2"></i>Nombre de Usuario
                  </label>
                      <input type="text" class="form-control" id="nombreUsuario" 
                        value="" required>
                  <small class="text-muted">Este es tu usuario para iniciar sesión</small>
                </div>

                <div class="mb-3">
                  <label for="correoUsuario" class="form-label fw-bold">
                    <i class="bi bi-envelope me-2"></i>Correo Electrónico
                  </label>
                      <input type="email" class="form-control" id="correoUsuario" 
                        value="" required>
                  <small class="text-muted">Correo para notificaciones del sistema</small>
                </div>

                <button type="submit" class="btn btn-primary w-100">
                  <i class="bi bi-save me-2"></i>Actualizar Usuario y Correo
                </button>
              </form>
              <!-- Contenedor para mensajes del formulario de usuario -->
              <div id="mensajeUsuario" class="mt-3"></div>
            </div>
          </div>
        </div>

   



<!-- FORMULARIO PARA CAMBIAR CONTRASEÑA DEL Sistema -->
        <div class="col-12 col-lg-6 mb-4">
          <div class="card shadow-sm h-100">
            <div class="card-header bg-warning-gradient text-dark">
              <h5 class="mb-0">
                <i class="bi bi-shield-lock me-2"></i>Cambiar Contraseña
              </h5>
            </div>
            <div class="card-body">
              <form id="formContrasena">
                <div class="mb-3">
                  <label for="contrasenaActual" class="form-label fw-bold">
                    <i class="bi bi-lock me-2"></i>Contraseña Actual
                  </label>
                  <div class="input-group">
                    <input type="password" class="form-control" id="contrasenaActual" required>
                    <button class="btn btn-outline-secondary" type="button" onclick="ocultarPass('contrasenaActual')">
                      <i class="bi bi-eye" id="iconContrasenaActual"></i>
                    </button>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="contrasenaNueva" class="form-label fw-bold">
                    <i class="bi bi-lock-fill me-2"></i>Nueva Contraseña
                  </label>
                  <div class="input-group">
                    <input type="password" class="form-control" id="contrasenaNueva" required>
                    <button class="btn btn-outline-secondary" type="button" onclick="ocultarPass('contrasenaNueva')">
                      <i class="bi bi-eye" id="iconContrasenaNueva"></i>
                    </button>
                  </div>
                  <small class="text-muted">Mínimo 8 caracteres</small>
                </div>

                <div class="mb-3">
                  <label for="contrasenaConfirmar" class="form-label fw-bold">
                    <i class="bi bi-lock-fill me-2"></i>Confirmar Nueva Contraseña
                  </label>
                  <div class="input-group">
                    <input type="password" class="form-control" id="contrasenaConfirmar" required>
                    <button class="btn btn-outline-secondary" type="button" onclick="ocultarPass('contrasenaConfirmar')">
                      <i class="bi bi-eye" id="iconContrasenaConfirmar"></i>
                    </button>
                  </div>
                </div>

                <button type="submit" class="btn btn-warning w-100">
                  <i class="bi bi-key-fill me-2"></i>Cambiar Contraseña
                </button>
              </form>
              <!-- Contenedor para mensajes del formulario de cambio de contraseña -->
              <div id="mensajeContrasena" class="mt-3"></div>
            </div>
          </div>
        </div>
      </div>


<div class="row mb-4">

           <!-- Sección: Configuración SMTP -->
<div class="col-12 col-lg-6 mb-4">
  <div class="card shadow-sm h-100">
    <div class="card-header bg-info-gradient text-white">
      <h5 class="mb-0">
        <i class="bi bi-gear me-2"></i>Configuración de Correo SMTP
      </h5>
    </div>

    <div class="card-body">
      <form id="formSMTP">

        <!-- Seleccionar proveedor -->
        <div class="mb-3">
          <label class="form-label fw-bold">
            <i class="bi bi-envelope-at me-2"></i>Proveedor de correo
          </label>
          <select class="form-select" id="smtpProveedor">
            <option value="gmail">Gmail</option>
            <option value="outlook">Outlook</option>
            <option value="yahoo">Yahoo</option>
            <option value="otro">Otro proveedor</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="smtpCorreo" class="form-label fw-bold">
            <i class="bi bi-envelope-open me-2"></i>Correo SMTP
          </label>
          <input type="email" class="form-control" id="smtpCorreo"
                 placeholder="correo@ejemplo.com" required>
        </div>

        <div class="mb-3">
          <label for="smtpContrasena" class="form-label fw-bold">
            <i class="bi bi-key me-2"></i>Contraseña de Aplicación
          </label>
          <input type="password" class="form-control" id="smtpContrasena"
                 placeholder="Contraseña de aplicación" required>
        </div>

        <!-- Campos host/puerto (ocultos por defecto) -->
        <div id="extraConfig" style="display:none;">
          <div class="mb-3">
            <label class="form-label fw-bold">Host SMTP</label>
            <input type="text" class="form-control" id="smtpHost" placeholder="smtp.servidor.com">
          </div>

          <div class="mb-3">
            <label class="form-label fw-bold">Puerto</label>
            <input type="number" class="form-control" id="smtpPuerto" placeholder="587">
          </div>
        </div>

        <button type="submit" class="btn btn-info w-100">
          <i class="bi bi-save me-2"></i>Guardar Configuración SMTP
        </button>

      </form>
    </div>
  </div>
</div>




<!-- FORMULARIO MULTA -->
  <div class="col-12 col-lg-6 mb-4">
    <div class="card shadow-sm h-100">
      <!-- Cambiamos el color de la cabecera para diferenciarlo -->
      <div class="card-header bg-success-gradient text-white">
        <h5 class="mb-0">
          <i class="bi bi-currency-dollar me-2"></i>Configurar Multa por Retraso
        </h5>
      </div>
      <div class="card-body">
        <form id="formMultaConfig">
          <div class="mb-3">
            <label for="valorMulta" class="form-label fw-bold">
              <i class="bi bi-cash-stack me-2"></i>Valor de la Multa por Día ($)
            </label>
            <input type="text" class="form-control" id="valorMulta" step="0.01" min="0" value="1.00" required>
            <small class="text-muted">Ingrese el valor de la multa por cada día de retraso</small>
          </div>

          <div class="mb-3">
            <label for="diasTolerancia" class="form-label fw-bold">
              <i class="bi bi-calendar3 me-2"></i>Días de Tolerancia
            </label>
            <input type="number" class="form-control" id="diasTolerancia" min="0" value="0" required>
            <small class="text-muted">Cantidad de días que el usuario puede retrasarse sin multa</small>
          </div>

          <button type="submit" class="btn btn-success w-100">
            <i class="bi bi-save me-2"></i>Guardar Configuración
          </button>
        </form>
        <div id="mensajeMultaConfig" class="mt-3"></div>
      </div>
    </div>
  </div>

</div>



<!-- FORMULARIO DE WHATSAPP -->
<div class="card shadow-sm mt-3">
  <div class="card-header bg-success text-white">
    <b><i class="bi bi-whatsapp"></i> Conectar WhatsApp</b>
  </div>

  <div class="card-body text-center">
    <button class="btn btn-success mb-3" onclick="mostrarQR()">
      Generar QR
    </button>

    <div id="qrContainer" style="display:none;">
      <h6>Escanea el QR desde tu WhatsApp</h6>
      <img id="qrImage" src="" style="width: 250px; height: 250px;" />
    </div>
  </div>
</div>



    
      <!-- Sección: Vista Previa -->
      <div class="row">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-header bg-success-gradient text-white">
              <h5 class="mb-0">
                <i class="bi bi-eye me-2"></i>Vista Previa de la Personalización
              </h5>
            </div>
            <div class="card-body text-center py-5">
              <div class="preview-container">
                <img src="/placeholder.svg?height=120&width=120" 
                     alt="Logo preview" 
                     class="preview-logo mb-3" 
                     id="logoPreviewSmall">
                 <h2 class="preview-nombre mb-2" id="previewNombreInstitucion">Universidad Nacional de Educación</h2>
                 <h4 class="preview-plataforma text-muted mb-2" id="previewNombrePlataforma">Sistema de Gestión Bibliotecaria</h4>
                 <p class="preview-eslogan fst-italic" id="previewEslogan">Fomentando el amor por la lectura</p>
                 <p class="preview-telefono mb-1" id="previewTelefono"><i class="bi bi-telephone me-2"></i><span>Teléfono no definido</span></p>
                 <p class="preview-direccion text-muted small" id="previewDireccion"><i class="bi bi-geo-alt me-2"></i><span>Dirección no definida</span></p>
                <div class="mt-4">
                  <span class="badge preview-badge me-2" style="background-color: #003049;">Color Primario</span>
                  <span class="badge preview-badge me-2" style="background-color: #023e8a;">Color Secundario</span>
                  <span class="badge preview-badge" style="background-color: #669bbc;">Color de Acento</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>

  <!-- Modal de mensaje -->
  <div class="modal fade" id="modalMensaje" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div id="modalMensajeHeader" class="modal-header">
          <h5 class="modal-title" id="modalMensajeTitulo"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="modalMensajeBody"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
        </div>
      </div>
    </div>
  </div>


  <!-- Scripts -->
  <script src="/JS/perfil.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
